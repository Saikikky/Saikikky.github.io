<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">



  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="实习学习总结,">










<meta name="description" content="Spring Cloud简介Spring Cloud不是云计算解决方案，而是在SpringBoot上构建的，用于快速构建分布式系统的通用模式的工具集。 Spring Cloud是一个基于Spring Boot实现的云原生应用开发工具，它为基于JVM的云原生应用开发中涉及的配置管理、服务发现、熔断器、智能路由、微代理、控制总线、分布式会话和集群状态管理等操作提供了一种简单的开发方式。 特点 约定大于">
<meta name="keywords" content="实习学习总结">
<meta property="og:type" content="article">
<meta property="og:title" content="Spring Cloud">
<meta property="og:url" content="http://yoursite.com/2019/07/22/Spring Cloud/index.html">
<meta property="og:site_name" content="Saikikky">
<meta property="og:description" content="Spring Cloud简介Spring Cloud不是云计算解决方案，而是在SpringBoot上构建的，用于快速构建分布式系统的通用模式的工具集。 Spring Cloud是一个基于Spring Boot实现的云原生应用开发工具，它为基于JVM的云原生应用开发中涉及的配置管理、服务发现、熔断器、智能路由、微代理、控制总线、分布式会话和集群状态管理等操作提供了一种简单的开发方式。 特点 约定大于">
<meta property="og:locale" content="default">
<meta property="og:image" content="http://yoursite.com/Users/saikikky/Documents/专业学习/Blog/source/_posts/image/服务治理.jpg">
<meta property="og:updated_time" content="2019-10-10T03:30:27.459Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Spring Cloud">
<meta name="twitter:description" content="Spring Cloud简介Spring Cloud不是云计算解决方案，而是在SpringBoot上构建的，用于快速构建分布式系统的通用模式的工具集。 Spring Cloud是一个基于Spring Boot实现的云原生应用开发工具，它为基于JVM的云原生应用开发中涉及的配置管理、服务发现、熔断器、智能路由、微代理、控制总线、分布式会话和集群状态管理等操作提供了一种简单的开发方式。 特点 约定大于">
<meta name="twitter:image" content="http://yoursite.com/Users/saikikky/Documents/专业学习/Blog/source/_posts/image/服务治理.jpg">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2019/07/22/Spring Cloud/">





  <title>Spring Cloud | Saikikky</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>
    
    <a href="https://github.com/Saikikky" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewbox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"/><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"/><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"/></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Saikikky</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/07/22/Spring Cloud/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Saikikky Wang">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Saikikky">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Spring Cloud</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-07-22T08:59:05+08:00">
                2019-07-22
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="Spring-Cloud"><a href="#Spring-Cloud" class="headerlink" title="Spring Cloud"></a>Spring Cloud</h2><h4 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h4><p>Spring Cloud不是云计算解决方案，而是在SpringBoot上构建的，用于快速构建分布式系统的通用模式的工具集。</p>
<p><strong><em>Spring Cloud是一个基于Spring Boot实现的云原生应用开发工具，它为基于JVM的云原生应用开发中涉及的配置管理、服务发现、熔断器、智能路由、微代理、控制总线、分布式会话和集群状态管理等操作提供了一种简单的开发方式。</em></strong></p>
<h4 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h4><ul>
<li>约定大于配置</li>
<li>适用于各种环境</li>
<li>隐藏了组件的复杂性，并提供声明式、无XML的配置方式</li>
<li>开箱即用，快速启动</li>
<li>组件丰富，功能齐全</li>
</ul>
<h4 id="核心子项目"><a href="#核心子项目" class="headerlink" title="核心子项目"></a>核心子项目</h4><p>微服务是可以独立部署、水平扩展、独立访问（或者有独立的数据库）的服务单元，SpringCloud就是这些微服务的大管家，采用了微服务这种架构之后，项目的数量会非常多，SpringCloud做为大管家需要管理好这些微服务，自然需要很多小弟来帮忙。</p>
<p>Netflix 与各种Netflix OSS组件集成，组成微服务的核心。</p>
<p>Config 配置管理工具，实现应用配置的外部化存储，支持客户端配置信息刷新、加密/解密配置内容等。</p>
<p>Bus 事件、消息总线，用于传播集群中的状态变化或事件，以及触发后续的处理。</p>
<p>Security等</p>
<h3 id="Eureka-服务中心"><a href="#Eureka-服务中心" class="headerlink" title="Eureka(服务中心)"></a>Eureka(服务中心)</h3><p>是一款提供服务注册和发现的产品。服务中心又叫注册中心，管理各种服务功能包括服务的注册、发现、熔断、负载、降级等，有了服务中心之后，所有调用都要通过服务中心去调用。</p>
<p>Eureka是一个基于REST的服务，主要在AWS云中使用，定位服务来进行中间层服务器的负载均衡和故障转移。</p>
<p>Eureka由两个组件组成：Eureka服务器和Eureka客户端。服务器用作服务注册服务器，客户端是一个Java客户端，用来简化与服务器的交互、作为轮询负载均衡器，并提供服务的故障切换支持。</p>
<p>Eureka Server提供服务注册和发现，Service Provider服务提供方，将自身服务注册到Eureka，从而使服务消费方能够找到，Service Consumer服务消费方，从Eureka获取注册服务列表，从而能够消费服务。</p>
<p>Eureka是Netflix服务发现的服务端与客户端，Eureka提供服务注册以及服务发现的能力，当是Eureka Server时(注册中心)，所有的客户端会向其注册，当是Eureka Client时，可以从注册中心获取对应的服务信息，或者是向Eureka Server将自己作为实例注册进去，每个Eureka不仅仅是一个服务端同时还是一个客户端。</p>
<p>当Eureka想要成为注册中心时，必须将注册中心的服务地址指向自己，同时禁用服务检索的功能。Eureka是一个高可用的组件，它没有后端缓存，每一个实例注册之后需要向注册中心发送心跳来检测服务的可用性，注册中心不处理请求的转发，只是记录每个实例注册进来的信息。</p>
<p>注册中心页面：<a href="http://localhost:8000/" target="_blank" rel="noopener">http://localhost:8000/</a></p>
<p>+++</p>
<p><strong>集群</strong></p>
<p>为了维持注册中心的高可用性，通常会使用集群，Eureka通过互相注册的方式来实现高可用的部署，所以只需要将Eureka Server配置其他可用的serviceUrl就可以实现高可用部署。</p>
<p>+++</p>
<p><strong>服务的提供与调用</strong></p>
<p>三个角色：服务注册中心、服务提供者和服务消费者。流程是首先启动注册中心，服务提供者生产服务并注册到服务中心中，消费者从服务中心中获取服务并执行。</p>
<ul>
<li>服务提供者的启动类上加上@EnableDiscoveryClient注解：能够让注册中心能够发现，扫描到该服务。</li>
</ul>
<p>@EnableDiscoveryClient和@EnableEurekaClient的区别是：后者只能用于Eureka做注册中心时，但前者也可以用于其他注册中心。</p>
<ul>
<li>服务消费者的启动类上加上@EnableFeignClients注解：启用feign进行远程调用。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Feign是一个声明式Web Service客户端。使用Feign能让编写Web Service客户端更加简单，它的使用方法是定义一个接口，然后在上面添加注解，同时也支持JAX-RS标准的注解。Feign也支持可拔插式的编码器和解码器。Spring Cloud对Feign进行了封装，使其支持Spring MVC标准注解和HttpMessageConverters。Feign可以与Eureka和Ribbon组合使用支持负载均衡。</span><br></pre></td></tr></table></figure>
<hr>
<h4 id="Ribbon"><a href="#Ribbon" class="headerlink" title="Ribbon"></a>Ribbon</h4><p>服务消费者有两个目标分别是发现服务和消费服务，其中服务发现的任务由Eureka的客户端完成，服务消费的任务则由Ribbon完成。Ribbon是一个基于HTTP和TCP的客户端负载均衡器，可以在通过客户端中配置的ribbonServerList服务端列表去轮询访问以达到均衡负载的作用。当Ribbon和Eureka联合使用时，Ribbon的服务实例清单RibbonServerList会被DiscoveryEnabledNIWSServerList重写，扩展成从Eureka注册中心中获取服务端列表。</p>
<ul>
<li>服务提供者只需要启动多个服务实例并注册到一个注册中心或是多个相关联的服务注册中心。</li>
<li>服务消费者直接通过调用被@LoadBalanced注解修饰过的RestTemplate来实现面向服务的接口调用。</li>
</ul>
<p>Ribbon开启负载均衡，在启动类中加入如下方法和注解@LoadBalanced</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@LoadBalanced</span></span><br><span class="line"><span class="function">RestTemplate <span class="title">restTemplate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> RestTemplate();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//RestTemplate是Spring提供的用于访问Rest服务的客户端，RestTemplate提供了多种便捷访问远程Http服务的方法,能够大大提高客户端的编写效率。</span></span><br></pre></td></tr></table></figure>
<p>Spring Cloud Ribbon 通过LoadBalancerInterceptor拦截器对RestTemplate的请求进行拦截，并利用Spring Cloud的负载均衡器LoadBalancerClient将以逻辑服务名为host的URI转换成具体的服务实例地址的过程。</p>
<h5 id="客户端负载均衡"><a href="#客户端负载均衡" class="headerlink" title="客户端负载均衡"></a>客户端负载均衡</h5><p>负载均衡是对系统的高可用、网络压力的缓解和处理能力扩容的重要手段之一。一般的负载均衡指的是服务端的负载均衡，负责负载均衡的模块会维护一个下挂可用的服务端清单，通过心跳检测来保证清单中的都是可以用的服务器节点。而客户端的负载均衡和服务端的最大区别是服务清单所存储的位置，这些服务清单来源于注册中心，也需要心跳去维持服务端清单的健康性，只是需要和服务注册中心配合完成。</p>
<p>+++</p>
<h4 id="Feign"><a href="#Feign" class="headerlink" title="Feign"></a>Feign</h4><p>Spring Cloud Feign整合了Spring Cloud Ribbon和Spring Cloud Hystrix。帮助定义和实现依赖服务接口的定义，在Feign的实现下，只需创建一个接口并用注解的方式来配置它，即可完成对服务提供方的接口绑定。</p>
<ul>
<li><strong>Feign</strong>调用实现</li>
</ul>
<p>Feign支持服务的调用以及均衡负载。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FeignClient</span>(name= <span class="string">"spring-cloud-producer"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">HelloRemote</span> </span>&#123;</span><br><span class="line">    <span class="meta">@RequestMapping</span>(value = <span class="string">"/hello"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">hello</span><span class="params">(@RequestParam(value = <span class="string">"name"</span>)</span> String name)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>name：远程服务名即spring.application.name配置的名称</li>
<li>此类中的方法和远程服务中contoller中的方法名和参数需保持一致。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 远程服务controller</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloController</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/hello"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">index</span><span class="params">(@RequestParam String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"hello "</span>+name+<span class="string">"，this is first messge"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>web层调用远程服务</li>
</ul>
<p>将接口注入到controller层，像普通方法一样去调用即可。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConsumerController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    HelloRemote HelloRemote;</span><br><span class="line">	</span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/hello/&#123;name&#125;"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">index</span><span class="params">(@PathVariable(<span class="string">"name"</span>)</span> String name) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> HelloRemote.hello(name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h4 id="服务治理机制"><a href="#服务治理机制" class="headerlink" title="服务治理机制"></a>服务治理机制</h4><p><img src="/Users/saikikky/Documents/专业学习/Blog/source/_posts/image/服务治理.jpg" alt="服务治理"></p>
<h5 id="服务提供者"><a href="#服务提供者" class="headerlink" title="服务提供者"></a>服务提供者</h5><h6 id="服务注册"><a href="#服务注册" class="headerlink" title="服务注册"></a>服务注册</h6><p>“服务提供者”在启动的时候会通过发送REST请求的方式将自己注册到Eureka Server上，同时带上了自身服务的一些元数据信息。Eureka Server接收到这个REST请求之后，将元数据信息存储在一个双层结构Map中，其中第一层的key是服务名，第二层的key是具体服务的实例名(一个服务可以用多个实例，这些内容都是以双层的Map形式存储的)</p>
<h6 id="服务同步"><a href="#服务同步" class="headerlink" title="服务同步"></a>服务同步</h6><p>如上图架构图所示，这里的两个服务提供者分别注册到了两个不同的服务注册中心上，也就是说，它们的信息分别被两个服务注册中心所维护。此时，由于服务注册中心之间因为互相注册为服务，当服务提供者发送注册请求到一个服务注册中心时，它会将该请求转发给集群中相连的其他注册中心，从而实现注册中心之间的服务同步。通过服务同步，两个服务提供者的服务信息就可以通过这两台服务注册中心中的任意一台获取到。</p>
<h6 id="服务续约"><a href="#服务续约" class="headerlink" title="服务续约"></a>服务续约</h6><p>在注册完服务之后，服务提供者会维护一个心跳用来持续高速Eureka Server”我还活着“，以防止Server剔除任务将该服务实例从服务列表中排除出去，我们称之为服务续约(Renew)</p>
<h5 id="服务消费者"><a href="#服务消费者" class="headerlink" title="服务消费者"></a>服务消费者</h5><h6 id="获取服务"><a href="#获取服务" class="headerlink" title="获取服务"></a>获取服务</h6><p>启动服务消费者的时候，会发送一个REST请求给服务注册中心，来获取上面注册的服务清单。</p>
<h6 id="服务调用"><a href="#服务调用" class="headerlink" title="服务调用"></a>服务调用</h6><p>获取服务清单之后，通过服务名可以获得具体提供服务的实例名和该实例的元数据信息，所以客户端可以根据自己的需要选择调用的实例。</p>
<p>对于实例的选择，Eureka中有Region和Zone的概念，一个Region中可以包含多个Zone，每个服务客户端需要被注册到一个Zone中，所以每个客户端对应一个Region和一个Zone。在服务调用的时候，优先访问同处一个Zone中的服务提供方，若访问不到，就访问其他的Zone。</p>
<h6 id="服务下线"><a href="#服务下线" class="headerlink" title="服务下线"></a>服务下线</h6><p>在客户端程序中，当服务实例进行正常的关闭操作时，会触发一个服务下线的REST请求给Eureka Server，服务端在接收到请求之后，将该服务状态置为下线(down)，并把该下线事件传播出去。</p>
<h5 id="服务注册中心"><a href="#服务注册中心" class="headerlink" title="服务注册中心"></a>服务注册中心</h5><h6 id="失效剔除"><a href="#失效剔除" class="headerlink" title="失效剔除"></a>失效剔除</h6><p>将一些无法提供服务的实例剔除，Eureka Server在启动的时候会创建一个定时任务，默认每隔一段时间(默认60s)将当前清单中超时(90s)没有续约的服务剔除出去。</p>
<h6 id="自我保护"><a href="#自我保护" class="headerlink" title="自我保护"></a>自我保护</h6><p>注册中心的信息面板上有一个红色的警告信息，就是触法了自我保护机制。在运行期间，会统计心跳失败的比例在15分钟内是否低于85%(单机调试的情况很好满足，但实际生产环境通常是因为网络不稳定)，如果出现低的情况就会触发自我保护机制，将当前的实例注册信息保护起来，让这些实例不会过期，但是，在这段保护期间内实例若出现问题，那么客户端很容易拿到实际已经不存在的服务实例，出现调用失败的情况，所以客户端要有容错机制，比如可以使用请求重试、断路器等机制。</p>
<p>+++</p>
<h3 id="Hystrix-熔断器"><a href="#Hystrix-熔断器" class="headerlink" title="Hystrix(熔断器)"></a>Hystrix(熔断器)</h3><p>处理服务的熔断防止故障扩散。Hystrix具备服务降级、服务熔断、线程和信号隔离、请求缓存、请求合并以及服务监控等强大功能。</p>
<h4 id="雪崩效应"><a href="#雪崩效应" class="headerlink" title="雪崩效应"></a>雪崩效应</h4><p>是一种因“服务提供者”的不可用导致“服务消费者”的不可用，并将不可用逐渐放大的过程。</p>
<p>例如微服务A调用微服务B和微服务C，微服务B和微服务C又调用其他的微服务，如果扇出的链路上某个微服务的响应时间过程或者不可用，对微服务A的调用就会占用越来越多的系统资源，造成系统崩溃。</p>
<hr>
<p>特性：断路器机制、Fallback、资源隔离：通过线程池来实现资源隔离，在使用时会根据调用的远程服务划分出多个线程池，这样运行环境被隔离开了，这样就算调用服务的代码存在bug或者由于其他原因导致自己所在线程池被耗尽时，不会对系统的其他服务造成影响。</p>
<p>熔断只是作用在服务调用这一端。</p>
<p>Feign中的Hystrix默认关闭，因为开发者可能不想在客户端中使用断路器，但只是通过使用Feign来获取断路器。 选择加入方法会更加理想，用户必须在其应用程序中为其FeignClient启用Hystrix。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">feign:</span></span><br><span class="line"><span class="attr">  hystrix:</span></span><br><span class="line"><span class="attr">    enabled:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>
<p>Hystrix的依赖隔离，是给每个依赖服务创建一个独立的线程池，会产生额外的消耗延迟，但这个消耗延迟对于灵活性和健壮性的增长是可以接受的，那么对于小部分延迟本身就非常小的请求，这个开销还是非常昂贵的，这个时候可以使用信号量来控制单个依赖服务的并发度，信号量的开销远比线程池要小，但是不能设置超时访问和实现异步访问，所以只用在少数依赖服务足够可靠的情况。</p>
<p>fallback方法是Hystrix命令执行失败时使用的后备方法，用来实现服务的降级处理逻辑。</p>
<h3 id="Spring-Cloud-Config"><a href="#Spring-Cloud-Config" class="headerlink" title="Spring Cloud Config"></a>Spring Cloud Config</h3><ul>
<li>提供服务端和客户端支持</li>
<li>集中管理各种环境的配置文件</li>
<li>配置文件修改之后，可以快速的生效</li>
<li>可以进行版本管理</li>
<li>支持大的并发查询</li>
<li>支持各种语言</li>
</ul>
<p>Spring Cloud Config项目是一个解决分布式系统的配置管理方案。它包括Client和Server两个部分，server提供配置文件的存储、以接口的形式将配置文件的内容提供出去，client通过接口获取数据、并依据此数据初始化自己的应用，Spring Cloud使用git或者svn存放配置文件，默认情况下使用git。</p>
<h3 id="zuul服务网关"><a href="#zuul服务网关" class="headerlink" title="zuul服务网关"></a>zuul服务网关</h3><p>在微服务架构中，后端服务不直接开放给调用端，而是通过一个API网关根据请求的url，路由到响应的服务。当添加API网关之后，在第三方调用端和服务提供方之间就创建了一面墙，这面墙直接与调用方通信进行权限控制，后将请求均衡分发给后台服务器。</p>
<p>使用API Gateway的原因是</p>
<ul>
<li><p>简化客户端调用复杂度</p>
</li>
<li><p>数据剪裁以及聚合</p>
<p>可以剪裁以适应不同客户端需求，也可以将多个API调用逻辑进行聚合，减少客户端的请求端，优化客户端用户体验。</p>
</li>
<li><p>多渠道支持</p>
</li>
<li><p>遗留系统的微服务化改造</p>
</li>
</ul>
<h4 id="zuul"><a href="#zuul" class="headerlink" title="zuul"></a>zuul</h4><p>Spring Cloud Zuul路由是微服务架构的不可或缺的一部分，提供动态路由，监控，弹性，安全等边缘服务，Zuul是Netflix出品的一个基于JVM路由和服务端的负载均衡器。</p>
<ol>
<li><p>加入zuul的依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-zuul<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>在启动类中加入@EnableZuulProxy注解开启Zuul的API网关服务功能</p>
</li>
<li><p>在application.properties中配置Zuul应用的基础信息，如用户名、服务端口号等。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">spring.application.name=api-gateway</span><br><span class="line">server.port=5555</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h5 id="请求路由"><a href="#请求路由" class="headerlink" title="请求路由"></a>请求路由</h5><p>实现路由功能非常简单，只需要对api-gateway服务增加一些关于路由规则的配置，就能实现传统的路由转发功能。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">zuul.routes.api-a-url.path=/api-a-url/**</span><br><span class="line">zuul.routes.api-a-url.url=http://localhost:8080/</span><br></pre></td></tr></table></figure>
<p>该配置定义了发往API网关服务的请求中，所有符合/api-a-url/**规则的访问都将被路由转发到<a href="http://localhost:8080/地址上，当我们访问http://localhost:5555/api-a-url/hello的时候，API网关服务会将该请求路由到http://localhost:8080/hello提供的微服务接口上。配置属性zuul.routes.api-a-url.path中的api-a-url部分为路由的名字，可以任意定义，但是一组path和url映射关系的路由名要相同。" target="_blank" rel="noopener">http://localhost:8080/地址上，当我们访问http://localhost:5555/api-a-url/hello的时候，API网关服务会将该请求路由到http://localhost:8080/hello提供的微服务接口上。配置属性zuul.routes.api-a-url.path中的api-a-url部分为路由的名字，可以任意定义，但是一组path和url映射关系的路由名要相同。</a></p>
<h5 id="请求过滤"><a href="#请求过滤" class="headerlink" title="请求过滤"></a>请求过滤</h5><p>每个客户端用户请求微服务应用提供的接口时，它们的访问权限往往都有一定的限制，系统并不会将所有的微服务接口都对它们开放。最好的方法是通过前置的网关服务来完成这些非业务性质的校验。在请求到达的时候就完成校验和过滤，而不是转发之后再过滤而导致更长的请求延迟。Zuul允许开发者在API网关上通过定义过滤器来实现对请求的拦截和过滤，只需要继承ZuulFilter抽象类并实现它定义的4个抽象函数就可以完成对请求的拦截和过滤。</p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/实习学习总结/" rel="tag"># 实习学习总结</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/07/11/Java并发容器和框架/" rel="next" title="Java并发容器和框架">
                <i class="fa fa-chevron-left"></i> Java并发容器和框架
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/07/29/搭建Spring Cloud Demo中遇到的问题/" rel="prev" title="搭建Spring Cloud Demo中遇到的问题">
                搭建Spring Cloud Demo中遇到的问题 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Saikikky Wang</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">21</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">5</span>
                  <span class="site-state-item-name">tags</span>
                
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Spring-Cloud"><span class="nav-number">1.</span> <span class="nav-text">Spring Cloud</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#简介"><span class="nav-number">1.0.1.</span> <span class="nav-text">简介</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#特点"><span class="nav-number">1.0.2.</span> <span class="nav-text">特点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#核心子项目"><span class="nav-number">1.0.3.</span> <span class="nav-text">核心子项目</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Eureka-服务中心"><span class="nav-number">1.1.</span> <span class="nav-text">Eureka(服务中心)</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Ribbon"><span class="nav-number">1.1.1.</span> <span class="nav-text">Ribbon</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#客户端负载均衡"><span class="nav-number">1.1.1.1.</span> <span class="nav-text">客户端负载均衡</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Feign"><span class="nav-number">1.1.2.</span> <span class="nav-text">Feign</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#服务治理机制"><span class="nav-number">1.1.3.</span> <span class="nav-text">服务治理机制</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#服务提供者"><span class="nav-number">1.1.3.1.</span> <span class="nav-text">服务提供者</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#服务注册"><span class="nav-number">1.1.3.1.1.</span> <span class="nav-text">服务注册</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#服务同步"><span class="nav-number">1.1.3.1.2.</span> <span class="nav-text">服务同步</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#服务续约"><span class="nav-number">1.1.3.1.3.</span> <span class="nav-text">服务续约</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#服务消费者"><span class="nav-number">1.1.3.2.</span> <span class="nav-text">服务消费者</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#获取服务"><span class="nav-number">1.1.3.2.1.</span> <span class="nav-text">获取服务</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#服务调用"><span class="nav-number">1.1.3.2.2.</span> <span class="nav-text">服务调用</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#服务下线"><span class="nav-number">1.1.3.2.3.</span> <span class="nav-text">服务下线</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#服务注册中心"><span class="nav-number">1.1.3.3.</span> <span class="nav-text">服务注册中心</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#失效剔除"><span class="nav-number">1.1.3.3.1.</span> <span class="nav-text">失效剔除</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#自我保护"><span class="nav-number">1.1.3.3.2.</span> <span class="nav-text">自我保护</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Hystrix-熔断器"><span class="nav-number">1.2.</span> <span class="nav-text">Hystrix(熔断器)</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#雪崩效应"><span class="nav-number">1.2.1.</span> <span class="nav-text">雪崩效应</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Spring-Cloud-Config"><span class="nav-number">1.3.</span> <span class="nav-text">Spring Cloud Config</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#zuul服务网关"><span class="nav-number">1.4.</span> <span class="nav-text">zuul服务网关</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#zuul"><span class="nav-number">1.4.1.</span> <span class="nav-text">zuul</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#请求路由"><span class="nav-number">1.4.1.1.</span> <span class="nav-text">请求路由</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#请求过滤"><span class="nav-number">1.4.1.2.</span> <span class="nav-text">请求过滤</span></a></li></ol></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Saikikky Wang</span>

  
</div>



  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>




  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
